<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GOOGLE SIGN IN</title>
  </head>

  <body>
    <h1>GOOGLE SIGN IN</h1>
    <hr />
    <div
      id="g_id_onload"
      data-client_id="307099926676-mv8hsa7h7vchdv0c8qo9sg7d83rkj5km.apps.googleusercontent.com"
      data-callback="handleCredentialResponse"
      data-auto_prompt="false"
    ></div>
    <div
      class="g_id_signin"
      data-type="standard"
      data-size="large"
      data-theme="outline"
      data-text="sign_in_with"
      data-shape="rectangular"
      data-logo_alignment="left"
    ></div>
    <button id="google-sign-out">
      Sign out
    </button>
    <script>

      const url = window.location.hostname.includes('localhost') ? "http://localhost:8080/api/auth/google" : "https://restserver-smoe.herokuapp.com/api/auth/google"

      function handleCredentialResponse(response) {
        // decodeJwtResponse() is a custom function defined by you
        // to decode the credential response.
        //se serializa completo el objeto json y no solo el response.credential
        const body = JSON.stringify({'token_id':response.credential})
        /**
         * en fetch, se envia serializado un json {ab:9} y la respuesta en el then tambien se tiene que deserealizar .. por que asi trabaja el fetch
         */
        fetch(url, {
            'method': "post",
            'headers': {
                "Content-Type": "application/json",
            },
            body
        }).then( res => res.json())
        .then( res => {
          console.log(res);
          localStorage.setItem('email',res.email);
        }
        )
        .catch(err => console.warn)}

        const button = document.getElementById('google-sign-out');
        button.onclick = function() {
          google.accounts.id.disableAutoSelect();
          google.accounts.id.revoke(localStorage.getItem('email'),(done)=>{
            console.log(done);
            localStorage.clear();
            location.reload();
          })
        }
    </script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
  </body>
</html>
